{
  "contractName": "OracleProof",
  "constructorInputs": [
    {
      "name": "oraclePk",
      "type": "pubkey"
    },
    {
      "name": "domainSeparator",
      "type": "bytes4"
    },
    {
      "name": "expiryDuration",
      "type": "int"
    }
  ],
  "abi": [
    {
      "name": "verifyAndSpend",
      "inputs": [
        {
          "name": "spenderPk",
          "type": "pubkey"
        },
        {
          "name": "spenderSig",
          "type": "sig"
        },
        {
          "name": "oracleSig",
          "type": "datasig"
        },
        {
          "name": "oracleMessage",
          "type": "bytes"
        }
      ]
    },
    {
      "name": "composableVerify",
      "inputs": [
        {
          "name": "oracleSig",
          "type": "datasig"
        },
        {
          "name": "oracleMessage",
          "type": "bytes"
        }
      ]
    },
    {
      "name": "verifyWithPayloadConstraint",
      "inputs": [
        {
          "name": "spenderPk",
          "type": "pubkey"
        },
        {
          "name": "spenderSig",
          "type": "sig"
        },
        {
          "name": "oracleSig",
          "type": "datasig"
        },
        {
          "name": "oracleMessage",
          "type": "bytes"
        },
        {
          "name": "requiredMinValue",
          "type": "int"
        }
      ]
    }
  ],
  "bytecode": "OP_3 OP_PICK OP_0 OP_NUMEQUAL OP_IF OP_2ROT OP_CHECKSIGVERIFY OP_4 OP_ROLL OP_5 OP_PICK OP_ROT OP_CHECKDATASIGVERIFY OP_3 OP_ROLL OP_4 OP_SPLIT OP_4 OP_SPLIT OP_4 OP_SPLIT OP_DROP OP_2SWAP OP_EQUALVERIFY OP_SWAP OP_BIN2NUM OP_DUP OP_CHECKLOCKTIMEVERIFY OP_DROP OP_TXLOCKTIME OP_SWAP OP_3 OP_ROLL OP_ADD OP_LESSTHANOREQUAL OP_VERIFY OP_BIN2NUM OP_0 OP_NUMNOTEQUAL OP_NIP OP_ELSE OP_3 OP_PICK OP_1 OP_NUMEQUAL OP_IF OP_4 OP_ROLL OP_5 OP_PICK OP_ROT OP_CHECKDATASIGVERIFY OP_3 OP_ROLL OP_4 OP_SPLIT OP_4 OP_SPLIT OP_4 OP_SPLIT OP_DROP OP_2SWAP OP_EQUALVERIFY OP_SWAP OP_BIN2NUM OP_DUP OP_CHECKLOCKTIMEVERIFY OP_DROP OP_TXLOCKTIME OP_SWAP OP_3 OP_ROLL OP_ADD OP_LESSTHANOREQUAL OP_VERIFY OP_BIN2NUM OP_0 OP_NUMNOTEQUAL OP_NIP OP_ELSE OP_3 OP_ROLL OP_2 OP_NUMEQUALVERIFY OP_4 OP_ROLL OP_4 OP_ROLL OP_CHECKSIGVERIFY OP_3 OP_ROLL OP_4 OP_PICK OP_ROT OP_CHECKDATASIGVERIFY OP_ROT OP_4 OP_SPLIT OP_4 OP_SPLIT OP_4 OP_SPLIT OP_3 OP_ROLL OP_4 OP_ROLL OP_EQUALVERIFY OP_ROT OP_BIN2NUM OP_DUP OP_CHECKLOCKTIMEVERIFY OP_DROP OP_TXLOCKTIME OP_SWAP OP_4 OP_ROLL OP_ADD OP_LESSTHANOREQUAL OP_VERIFY OP_SWAP OP_BIN2NUM OP_0 OP_NUMNOTEQUAL OP_VERIFY OP_4 OP_SPLIT OP_DROP OP_BIN2NUM OP_LESSTHANOREQUAL OP_ENDIF OP_ENDIF",
  "source": "pragma cashscript ^0.11.0;\n\n// Oracle Proof Primitive\n// Verifies off-chain data signed by a trusted oracle.\n// Oracle message format: [domain 4B][timestamp 4B][nonce 4B][payload NB]\n// The oracle signs the full message using Schnorr signature.\n// This UTXO is stateless â€” consumed and destroyed after verification.\n\ncontract OracleProof(pubkey oraclePk, bytes4 domainSeparator, int expiryDuration) {\n\n    // Verify oracle data and allow a spender to spend.\n    function verifyAndSpend(\n        pubkey spenderPk,\n        sig spenderSig,\n        datasig oracleSig,\n        bytes oracleMessage\n    ) {\n        // Verify spender authorization\n        require(checkSig(spenderSig, spenderPk));\n\n        // Verify oracle signature over the message\n        require(checkDataSig(oracleSig, oracleMessage, oraclePk));\n\n        // Parse message: [domain(4)][timestamp(4)][nonce(4)][payload(N)]\n        bytes4 msgDomain, bytes rest1 = oracleMessage.split(4);\n        bytes4 msgTimestamp, bytes rest2 = rest1.split(4);\n\n        // Extract nonce (first 4 bytes of rest2)\n        bytes4 msgNonce = bytes4(rest2.slice(0, 4));\n\n        // Validate domain separator\n        require(msgDomain == domainSeparator);\n\n        // Validate timestamp: not expired\n        int timestamp = int(msgTimestamp);\n        require(tx.time >= timestamp);\n        require(tx.locktime <= timestamp + expiryDuration);\n\n        // Nonce must be non-zero (replay protection)\n        require(int(msgNonce) != 0);\n    }\n\n    // For composed transactions. Validates oracle proof without spender sig.\n    function composableVerify(\n        datasig oracleSig,\n        bytes oracleMessage\n    ) {\n        // Verify oracle signature\n        require(checkDataSig(oracleSig, oracleMessage, oraclePk));\n\n        // Parse and validate\n        bytes4 msgDomain, bytes rest1 = oracleMessage.split(4);\n        bytes4 msgTimestamp, bytes rest2 = rest1.split(4);\n        bytes4 msgNonce = bytes4(rest2.slice(0, 4));\n\n        require(msgDomain == domainSeparator);\n\n        int timestamp = int(msgTimestamp);\n        require(tx.time >= timestamp);\n        require(tx.locktime <= timestamp + expiryDuration);\n\n        require(int(msgNonce) != 0);\n    }\n\n    // Verify oracle data with a minimum payload value constraint.\n    function verifyWithPayloadConstraint(\n        pubkey spenderPk,\n        sig spenderSig,\n        datasig oracleSig,\n        bytes oracleMessage,\n        int requiredMinValue\n    ) {\n        require(checkSig(spenderSig, spenderPk));\n        require(checkDataSig(oracleSig, oracleMessage, oraclePk));\n\n        bytes4 msgDomain, bytes rest1 = oracleMessage.split(4);\n        bytes4 msgTimestamp, bytes rest2 = rest1.split(4);\n        bytes4 msgNonce, bytes payload = rest2.split(4);\n\n        require(msgDomain == domainSeparator);\n\n        int timestamp = int(msgTimestamp);\n        require(tx.time >= timestamp);\n        require(tx.locktime <= timestamp + expiryDuration);\n        require(int(msgNonce) != 0);\n\n        // Payload first 4 bytes = oracle value, must meet minimum\n        bytes4 valueBin = bytes4(payload.slice(0, 4));\n        int oracleValue = int(valueBin);\n        require(oracleValue >= requiredMinValue);\n    }\n}\n",
  "debug": {
    "bytecode": "5379009c6371ad547a55797bbb537a547f547f547f7572887c8176b175c57c537a93a16981009e77675379519c63547a55797bbb537a547f547f547f7572887c8176b175c57c537a93a16981009e7767537a529d547a547aad537a54797bbb7b547f547f547f537a547a887b8176b175c57c547a93a1697c81009e69547f7581a16868",
    "sourceMap": "12:4:41:5;;;;;19:25:19:46;:8::49:1;22:29:22:38:0;;:40::53;;:55::63;:8::66:1;25:40:25:53:0;;:60::61;:40::62:1;26:55:26:56:0;:43::57:1;29:48:29:49:0;:33::50:1;;32:16:32:44:0;:8::46:1;35:28:35:40:0;:24::41:1;36:27:36:36:0;:8::38:1;;37:16:37:27:0;:31::40;:43::57;;:31:::1;:16;:8::59;40:16:40:29;:33::34:0;:8::36:1;12:4:41:5;;44::63::0;;;;;49:29:49:38;;:40::53;;:55::63;:8::66:1;52:40:52:53:0;;:60::61;:40::62:1;53:55:53:56:0;:43::57:1;54:48:54:49:0;:33::50:1;;56:16:56:44:0;:8::46:1;58:28:58:40:0;:24::41:1;59:27:59:36:0;:8::38:1;;60:16:60:27:0;:31::40;:43::57;;:31:::1;:16;:8::59;62:16:62:29;:33::34:0;:8::36:1;44:4:63:5;;66::91::0;;;;73:25:73:35;;:37::46;;:8::49:1;74:29:74:38:0;;:40::53;;:55::63;:8::66:1;76:40:76:53:0;:60::61;:40::62:1;77:55:77:56:0;:43::57:1;78:53:78:54:0;:41::55:1;80:16:80:25:0;;:29::44;;:8::46:1;82:28:82:40:0;:24::41:1;83:27:83:36:0;:8::38:1;;84:16:84:27:0;:31::40;:43::57;;:31:::1;:16;:8::59;85:20:85:28:0;:16::29:1;:33::34:0;:16:::1;:8::36;88:50:88:51:0;:33::52:1;;89:26:89:39;90:8:90:49;9:0:92:1;",
    "logs": [],
    "requires": [
      {
        "ip": 9,
        "line": 19
      },
      {
        "ip": 15,
        "line": 22
      },
      {
        "ip": 26,
        "line": 32
      },
      {
        "ip": 30,
        "line": 36
      },
      {
        "ip": 38,
        "line": 37
      },
      {
        "ip": 42,
        "line": 40
      },
      {
        "ip": 54,
        "line": 49
      },
      {
        "ip": 65,
        "line": 56
      },
      {
        "ip": 69,
        "line": 59
      },
      {
        "ip": 77,
        "line": 60
      },
      {
        "ip": 81,
        "line": 62
      },
      {
        "ip": 91,
        "line": 73
      },
      {
        "ip": 97,
        "line": 74
      },
      {
        "ip": 109,
        "line": 80
      },
      {
        "ip": 113,
        "line": 83
      },
      {
        "ip": 121,
        "line": 84
      },
      {
        "ip": 126,
        "line": 85
      },
      {
        "ip": 132,
        "line": 90
      }
    ]
  },
  "compiler": {
    "name": "cashc",
    "version": "0.11.5"
  },
  "updatedAt": "2026-02-20T15:41:46.582Z"
}